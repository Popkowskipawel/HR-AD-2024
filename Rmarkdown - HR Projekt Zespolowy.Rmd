---
title: "Projekt Zespolowy HR"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
```

```{r}
library(dplyr)
library(readr)
HR=read.csv("HR.csv")
```

## Wstęp

### Usuwanie zbędnych kolumn

```{r}
HR <- HR %>% select(-EmployeeCount, -Over18, -StandardHours) 
```

### Wykrycie duplikatów

```{r}
duplikaty <- HR[duplicated(HR) | duplicated(HR, fromLast = TRUE), ]
```

### Wartośći brakujące

```{r}
library(naniar)
vis_miss(HR)
miss_var_summary(HR)
gg_miss_upset(HR)
gg_miss_var(HR)
```

Zmienną Attrition zmienimy na typ factor

```{r}
HR$Attrition <- factor(HR$Attrition, levels = c("No", "Yes"))
```

Imputacja danych

```{r}
library(mice)
HR_imputed <- mice(HR, m= 5, maxit = 50, seed = 500)
complete_data <- complete(HR_imputed)
```

```{r}
# Funkcja do identyfikacji odstających wartości (bazuje na IQR)
find_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  which(x < lower_bound | x > upper_bound)
}

# Zidentyfikuj odstające wartości dla kolumn liczbowych
boxplot(complete_data$YearsAtCompany)
boxplot(complete_data$NumCompaniesWorked)
boxplot(complete_data$PerformanceRating)
boxplot(complete_data$StockOptionLevel)
boxplot(complete_data$TotalWorkingYears)
```

Wizualizacja danych

```{r}
library(ggplot2)
```

```{r}
```


```{r}
library(gtsummary)
complete_data %>%
  select(Attrition,MonthlyIncome) %>%
  tbl_summary(
    by=Attrition,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = MonthlyIncome ~ "Przychód") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Tabela 1. Rozkład cen wg liczby pokoi**") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2))
```


```{r}
# Upewniamy się, że Attrition to faktor
complete_data$Attrition <- as.factor(complete_data$Attrition)

# Generowanie wykresu pudełkowego z dodaniem średniej
ggplot(complete_data, aes(x = Attrition, y = MonthlyIncome, fill = Attrition)) +
  geom_boxplot(outlier.color = "red", outlier.size = 2, alpha = 0.7) +
  stat_summary(
    fun = mean, 
    geom = "point", 
    shape = 18, 
    size = 3, 
    color = "black",
    position = position_dodge(width = 0.75)
  ) +
  labs(
    title = "Rozkład przychodów według statusu rotacji z zaznaczoną średnią",
    x = "Status rotacji (Attrition)",
    y = "Miesięczny przychód",
    fill = "Status rotacji"
  ) +
  scale_fill_manual(values = c("#FFA07A", "#87CEEB")) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    legend.position = "none"
  )
```

